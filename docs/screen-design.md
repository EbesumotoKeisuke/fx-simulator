# 画面設計書

## 1. 画面一覧

| 画面ID | 画面名 | 説明 | 対応機能ID |
|--------|--------|------|------------|
| SCR-001 | メイン画面（トレードシミュレーター） | チャート表示・トレード操作の統合画面 | F-001〜F-007, F-101, F-102, F-110 |
| SCR-002 | シミュレーション設定モーダル | シミュレーション開始前の設定 | F-006, F-108 |
| SCR-003 | シミュレーション結果モーダル | シミュレーション終了時の結果表示 | F-109 |
| SCR-004 | データ管理画面 | 為替データのインポート・管理 | F-008, F-111 |
| SCR-005 | パフォーマンス分析画面 | 詳細なパフォーマンス指標とグラフ表示 | F-105 |

---

## 2. 画面遷移図

```
                    +-------------------+
                    |   アプリ起動      |
                    +-------------------+
                            |
                            v
                    +-------------------+
                    |  SCR-001          |
                    |  メイン画面       |<-----------------+
                    +-------------------+                  |
                       |    |    |    |                    |
          +------------+    |    |    +------------+       |
          |                 |    |                 |       |
          v                 v    v                 v       |
    +-----------+    +-----------+    +-----------+ +-----------+
    | SCR-002   |    | SCR-003   |    | SCR-004   | | SCR-005   |
    | 設定      |    | 結果      |    | データ    | | 分析      |
    | モーダル  |    | モーダル  |    | 管理      | | 画面      |
    +-----------+    +-----------+    +-----------+ +-----------+
          |                 |                 |            |
          +-----------------+-----------------+------------+
```

---

## 3. 画面詳細設計

### 3.1 SCR-001: メイン画面（トレードシミュレーター）

#### 3.1.1 画面レイアウト

**対応解像度**: 13インチ以上（1366×768〜）

```
+-------------------------------------------------------------------------------------------+
| FX Trade Simulator          2024/01/15 10:30      [データ管理] [分析] [設定] [終了]       |
+-------------------------------------------------------------------------------------------+
| +---------------------------+ +---------------------------+ +---------------------------+ |
| |        日足 (D1)          | |      1時間足 (H1)         | |      10分足 (M10)         | |
| |                           | |                           | | [SL/TPライン表示]         | |
| | [ローソク足チャート]      | | [ローソク足チャート]      | | [ローソク足チャート]      | |
| |                           | |                           | | [予約注文ライン表示]      | |
| |                           | |                           | |                           | |
| |                           | |                           | |                           | |
| +---------------------------+ +---------------------------+ +---------------------------+ |
+-------------------------------------------------------------------------------------------+
| [▶再開] 速度:[1x▼] 状態:一時停止 | 注文:●成行○指値○逆指値 通貨:[5.4]×[10,000]        |
|                                   | =54,000通貨(証拠金:¥328,836) 現在価格:152.239         |
|                                   | [買い注文][売り注文] 1%リスク(¥550k): 1p549k 10p54k.. |
|                                   | SL:[☑ -20pips] TP:[☑ 30pips] ※pips値で指定           |
+-------------------------------------------------------------------------------------------+
| ポジション  [全決済]       | 予約注文  [全キャンセル]   | 口座情報                       |
| +----------+------+--------+ +----------+------+--------+ 残高: ¥1,000,000               |
| | 方向 | Lot  | Entry  ... | | タイプ   | Lot  | 価格   | 有効証拠金: ¥1,002,250         |
| +----------+------+--------+ +----------+------+--------+ 含み損益: +¥2,250              |
| | 買   | 0.10 | 145.50 ... | | 指値     | 0.10 | 145.00 | 確定損益: ¥0                   |
| | 売   | 0.05 | 145.80 ... | | 逆指値   | 0.05 | 146.00 | ────────────                   |
| +----------+------+--------+ +----------+------+--------+ 簡易分析                       |
| | SL/TP | 損益 | 操作       | | 作成日時 | 操作           | 勝率: 66.7%                    |
| +-------+------+------------+ +----------+----------------+ PF: 2.25                       |
|                              |                            | DD: -1.2%                      |
+-------------------------------------------------------------------------------------------+
```

**レイアウト構成（縦方向）**
| エリア | 高さ目安 | 説明 |
|--------|----------|------|
| ヘッダー | 40px | タイトル、時刻、ボタン |
| チャートエリア | 約400px | 3チャート横並び（均等幅） |
| コントロール＋注文パネル | 約80px | 左に再生制御、右に注文パネル（横並び統合レイアウト） |
| ポジション・予約注文・口座 | 約180px | ポジション一覧（左）+ 予約注文一覧（中央）+ 口座情報・簡易分析（右）の3カラム |

**レイアウト構成（横方向）**

*チャートエリア:*
| エリア | 幅比率 | 説明 |
|--------|--------|------|
| 日足チャート | 33% | 左 |
| 1時間足チャート | 33% | 中央 |
| 10分足チャート | 33% | 右 |

*ポジション・予約注文・口座エリア:*
| エリア | 幅比率 | 説明 |
|--------|--------|------|
| ポジション一覧 | 40% | 左 |
| 予約注文一覧 | 30% | 中央 |
| 口座情報・簡易分析 | 30% | 右 |

#### 3.1.2 画面要素詳細

**ヘッダー部**
| 要素 | タイプ | 説明 |
|------|--------|------|
| タイトル | テキスト | アプリ名「FX Trade Simulator」 |
| データ管理ボタン | ボタン | SCR-004へ遷移 |
| 分析ボタン | ボタン | SCR-005へ遷移 |
| 設定ボタン | ボタン | SCR-002モーダルを開く |
| 終了ボタン | ボタン | シミュレーションを終了（SCR-003表示） |

**チャートエリア（3つ）**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 日足チャート | ローソク足チャート | 日足のOHLCを表示 |
| 1時間足チャート | ローソク足チャート | 1時間足のOHLCを表示 |
| 10分足チャート | ローソク足チャート | 10分足のOHLCを表示 |

**チャート共通仕様**
- 各チャートの右端（最新）の時刻は同期する
- マウスホイールで時間軸のズーム
- ドラッグで時間軸のスクロール
- ローソク足にマウスオーバーでOHLCV詳細表示
- ローソク足にマウスオーバーで20EMA価格を表示（O/H/L/Cの右側に「EMA:xxx.xxx」形式）

**チャート更新ロジック（タイムフレーム境界チェック）**
- 各タイムフレームは境界を跨いだ時のみ更新される（過剰な更新を防止）
  - **M10（10分足）**: 10分単位の境界チェック（例: 10:00, 10:10, 10:20...）
  - **H1（1時間足）**: 時刻の境界チェック（年・月・日・時のいずれかが変化）
  - **D1（日足）**: 日付の境界チェック（年・月・日のいずれかが変化、24:00で更新）
- これにより、高速再生（5x, 10x）時でもチャートが点滅せずスムーズに更新される

**再生制御パネル（ControlBar・左側）**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 再生/一時停止ボタン | ボタン | シミュレーションの再生/一時停止切替 |
| 速度セレクタ | ドロップダウン | 再生速度（0.1x〜10x） |
| 状態表示 | テキスト | 実行中/一時停止/終了/未開始 |

**注文パネル（OrderPanel・右側）**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 注文タイプ | ラジオボタン | 成行/指値/逆指値を選択 |
| 通貨数量 | 数値入力 + ドロップダウン | 数量 × 単位（1,000/10,000/100,000） |
| 合計通貨表示 | テキスト | = XX,XXX通貨（数量×単位の計算結果） |
| 証拠金表示 | テキスト | (証拠金: ¥XXX,XXX)（レバレッジ25倍） |
| 価格入力 | 数値入力 | 指値・逆指値の場合のトリガー価格 |
| 現在価格表示 | テキスト | 現在のシミュレーション価格を表示 |
| 買い注文ボタン | ボタン（緑） | 買いエントリー注文を発注 |
| 売り注文ボタン | ボタン（赤） | 売りエントリー注文を発注 |

**レイアウト統合仕様**:
- 再生制御（ControlBar）と注文パネル（OrderPanel）は横並びで1つのエリアに統合表示
- ControlBarは再生制御のみ（注文機能を削除し簡素化）
- OrderPanelに合計通貨数と証拠金を追加（旧ControlBarの機能を吸収）

**SL/TP設定エリア（全注文タイプ共通で表示）**
| 要素 | タイプ | 説明 |
|------|--------|------|
| SLチェックボックス | チェックボックス | 損切り設定の有効/無効 |
| SL価格/pips切替 | ドロップダウン | pips指定/価格指定を選択 |
| SL入力 | 数値入力 | 損切り価格またはpips（例: -20） |
| SL説明 | テキスト | 「買いの場合は負の値、売りの場合は正の値を設定」 |
| TPチェックボックス | チェックボックス | 利確設定の有効/無効 |
| TP価格/pips切替 | ドロップダウン | pips指定/価格指定を選択 |
| TP入力 | 数値入力 | 利確価格またはpips（例: 30） |
| TP説明 | テキスト | 「買いの場合は正の値、売りの場合は負の値を設定」 |

**SL/TPプリセットボタン（共通定数: SLTP_PRESETS）**
- SLプリセット: [-10, -20, -30, -40, -50] pips
- TPプリセット: [10, 20, 30, 40, 50] pips
- 成行/指値/逆指値および SL/TP設定モーダルで共通の定数を使用

**表示制御**:
- SL/TPエリアは全注文タイプで表示
- 指値・逆指値選択時も成行と同じプリセットを表示
- 指値・逆指値選択時は価格が現在価格でプリセットされる
- チェックボックスがオフの場合、対応する入力フィールドは非表示

**1%リスクプリセット**:
- 全注文タイプで表示（成行のみではなく指値・逆指値でも表示）
- ロットプリセット: [-1p, 10p, 20p, 30p, 40p, 50p]（-1pipsプリセットを追加）

**予約注文一覧（中央カラム）**
| カラム | 説明 |
|--------|------|
| タイプ | 指値/逆指値 |
| 方向 | 買/売 |
| ロット | ロットサイズ |
| 価格 | トリガー価格 |
| 作成日時 | 注文作成時刻 |
| 操作 | 変更ボタン、キャンセルボタン |

**配置**
- ポジション一覧の右側、口座情報の左側に配置
- 3カラムレイアウト: ポジション（40%）、予約注文（30%）、口座情報（30%）

**シミュレーションコントロール**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 現在時刻表示 | テキスト | シミュレーション内の現在日時 |
| 最初に戻るボタン | ボタン | シミュレーション開始時刻に戻る |
| 前に戻るボタン | ボタン | 1ステップ（10分）戻る |
| 再生/一時停止ボタン | ボタン | シミュレーションの再生/一時停止切替 |
| 次に進むボタン | ボタン | 1ステップ（10分）進む |
| 最後に進むボタン | ボタン | データの最終時刻まで進む |
| 速度表示 | ドロップダウン | 再生速度（0.5x, 1x, 2x, 5x, 10x） |

**ポジション一覧（左カラム）**
| カラム | 説明 |
|--------|------|
| 方向 | 買/売 |
| 通貨 | 通貨数量（ロット × 100,000） |
| 証拠金 | 使用証拠金（レバレッジ25倍） |
| Entry | エントリー価格 |
| 現在 | 現在のシミュレーション価格 |
| SL | 損切り価格またはpips（例: 145.500 または -20p）、設定なしは「-」。SLの横にエントリー価格とSL価格のpips差を表示（例: "20p差"） |
| TP | 利確価格またはpips（例: 146.500 または 30p）、設定なしは「-」 |
| 損益(pips) | 含み損益（pips表示） |
| 損益(円) | 含み損益（円表示） |
| 操作 | SL/TPボタン、決済ボタン |

**SL/TP設定モーダル**
- **表示タイミング**: ポジション一覧の「SL/TP」ボタンクリック時
- **モーダルサイズ**: 幅500px
- **表示内容**:
  - ポジション情報：方向、エントリー価格、現在価格
  - SL設定エリア（チェックボックス + 入力フィールド）
  - TP設定エリア（チェックボックス + 入力フィールド）
  - キャンセルボタン、保存ボタン
- **入力制御**:
  - チェックボックスでSL/TPを個別に有効/無効化
  - 価格指定/pips指定の切り替え
  - 既存のSL/TP値がある場合は自動読み込み
- **バリデーション**:
  - 買いポジション：SLは負の値のみ、TPは正の値のみ（pips）
  - 売りポジション：SLは正の値のみ、TPは負の値のみ（pips）
  - 価格指定：エントリー価格との大小関係をチェック
  - エラー時はアラートを表示し保存を中断

**口座情報 & 簡易分析（右カラム）**

*口座情報セクション:*
| 項目 | 説明 |
|------|------|
| 初期資金 | シミュレーション開始時の資金 |
| 残高 | 現在の口座残高 |
| 有効証拠金 | 残高 + 含み損益 |
| 使用証拠金 | 全ポジションの証拠金合計（ヘッダーに表示） |
| 含み損益 | 保有ポジションの未実現損益合計 |
| 確定損益 | 決済済みトレードの損益合計 |
| トータル損益 | 含み損益 + 確定損益（パーセント表示付き） |

*パフォーマンス指標セクション（取引データがある場合のみ表示）:*
| 項目 | 説明 |
|------|------|
| 取引回数 | 決済済みトレードの総数（勝/負の内訳表示） |
| 勝率 | 勝ちトレード割合（50%以上で緑色、小数点1桁） |
| PF | プロフィットファクター（1.0以上で緑色、未満で赤色、小数点2桁） |
| 最大DD | 最大ドローダウン（金額と%の両方表示、赤色） |
| 最大連勝/連敗 | 連続記録（小さいフォント） |

**表示制御**:
- パフォーマンス指標セクションは `total_trades > 0` の場合のみ表示
- 5秒ごとに自動更新（シミュレーション実行中）

#### 3.1.3 画面アクション

| アクション | トリガー | 処理 |
|------------|----------|------|
| 成行買い注文発注 | 買いボタンクリック | POST `/api/v1/orders` (SL/TP含む) |
| 成行売り注文発注 | 売りボタンクリック | POST `/api/v1/orders` (SL/TP含む) |
| 予約注文作成 | 詳細注文パネルで発注 | POST `/api/v1/orders/pending` |
| 予約注文変更 | 変更ボタンクリック | PUT `/api/v1/orders/pending/{id}` |
| 予約注文キャンセル | キャンセルボタンクリック | DELETE `/api/v1/orders/pending/{id}` |
| 全予約注文キャンセル | 全キャンセルボタンクリック | 全予約注文を順次キャンセル |
| ポジション決済 | 決済ボタンクリック | POST `/api/v1/positions/{id}/close` |
| 全ポジション決済 | 全決済ボタンクリック | 全ポジションを順次決済 |
| SL/TP設定 | SL/TPボタンクリック | モーダル表示 → PUT `/api/v1/positions/{id}/sl-tp` |
| シミュレーション再生 | 再生ボタンクリック | POST `/api/v1/simulation/resume` |
| シミュレーション一時停止 | 一時停止ボタンクリック | POST `/api/v1/simulation/pause` → タイマー停止（即座に反映） |
| 速度変更 | ドロップダウン選択 | PUT `/api/v1/simulation/speed` |
| シミュレーション終了 | 終了ボタンクリック | POST `/api/v1/simulation/stop` → SCR-003表示 |
| 分析画面へ遷移 | 分析ボタンクリック | SCR-005へ遷移 |

**一時停止の即時反応実装**
- シミュレーション状態（running/paused）をRefで管理
- タイマーコールバック内で毎回状態をチェックし、paused状態の場合は処理を中断
- これにより、高速再生（5x, 10x）時でも一時停止ボタンを押した瞬間にチャート更新が停止する
- setIntervalのクリアだけでは既にスケジュールされたコールバックが実行されるため、この実装が必須

---

### 3.2 SCR-002: シミュレーション設定モーダル

#### 3.2.1 画面レイアウト

```
+------------------------------------------+
|  シミュレーション設定              [×]   |
+------------------------------------------+
|                                          |
|  開始日時                                |
|  +------------------------------------+  |
|  | 2024/01/15  09:00                  |  |
|  +------------------------------------+  |
|                                          |
|  初期資金                                |
|  +------------------------------------+  |
|  | ¥ 1,000,000                        |  |
|  +------------------------------------+  |
|                                          |
|  再生速度                                |
|  +------------------------------------+  |
|  | 1x                              ▼  |  |
|  +------------------------------------+  |
|                                          |
|  +------------------+ +----------------+ |
|  |    キャンセル    | |  開始する      | |
|  +------------------+ +----------------+ |
|                                          |
+------------------------------------------+
```

#### 3.2.2 画面要素詳細

| 要素 | タイプ | 説明 | バリデーション |
|------|--------|------|----------------|
| 開始日時 | 日時ピッカー | シミュレーション開始日時 | データ存在範囲内 |
| 初期資金 | 数値入力 | 初期口座残高 | 10,000〜100,000,000 |
| 再生速度 | ドロップダウン | 初期再生速度 | 0.5x, 1x, 2x, 5x, 10x |
| キャンセルボタン | ボタン | モーダルを閉じる | - |
| 開始するボタン | ボタン | シミュレーションを開始 | - |

#### 3.2.3 画面アクション

| アクション | トリガー | 処理 |
|------------|----------|------|
| シミュレーション開始 | 開始するボタンクリック | POST `/api/v1/simulation/start` |
| モーダルを閉じる | キャンセルボタン or ×ボタン | モーダルを閉じる |

---

### 3.3 SCR-003: シミュレーション結果モーダル

#### 3.3.1 画面レイアウト

```
+------------------------------------------+
|  シミュレーション結果              [×]   |
+------------------------------------------+
|                                          |
|  期間: 2024/01/15 09:00 〜 2024/01/20 17:00 |
|                                          |
|  +------------------------------------+  |
|  | 最終残高                           |  |
|  | ¥ 1,025,000                        |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  | 損益                               |  |
|  | +¥ 25,000 (+2.5%)                  |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  | トレード回数                       |  |
|  | 15 回                              |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  | 勝敗                               |  |
|  | 10勝 5敗 (勝率: 66.7%)             |  |
|  +------------------------------------+  |
|                                          |
|  +------------------+ +----------------+ |
|  |  CSV出力         | |  閉じる        | |
|  +------------------+ +----------------+ |
|                                          |
+------------------------------------------+
```

#### 3.3.2 画面要素詳細

| 要素 | タイプ | 説明 |
|------|--------|------|
| 期間 | テキスト | シミュレーション期間 |
| 最終残高 | テキスト | シミュレーション終了時の残高 |
| 損益 | テキスト | 初期資金からの損益額とパーセンテージ |
| トレード回数 | テキスト | 決済済みトレードの総数 |
| 勝敗 | テキスト | 勝ち/負けの回数と勝率 |
| CSV出力ボタン | ボタン | トレード履歴をCSVダウンロード |
| 閉じるボタン | ボタン | モーダルを閉じる |

#### 3.3.3 画面アクション

| アクション | トリガー | 処理 |
|------------|----------|------|
| CSV出力 | CSV出力ボタンクリック | GET `/api/v1/trades/export` → ダウンロード |
| モーダルを閉じる | 閉じるボタン or ×ボタン | モーダルを閉じて新規シミュレーション待機状態へ |

---

### 3.4 SCR-004: データ管理画面

#### 3.4.1 画面レイアウト

```
+-----------------------------------------------------------------------------------+
|  FX Trade Simulator - データ管理                                      [← 戻る]   |
+-----------------------------------------------------------------------------------+
|                                                                                   |
|  ローカルデータ状況                                                               |
|  +-------------------------------------------------------------------------------+|
|  | 時間足 | データ期間                    | レコード数 | 最終更新              ||
|  +--------+-------------------------------+------------+-----------------------+|
|  | 日足   | 2020/01/01 〜 2024/12/31      | 1,305      | 2024/01/10 15:30      ||
|  | 1時間足| 2022/01/01 〜 2024/12/31      | 26,304     | 2024/01/10 15:30      ||
|  | 10分足 | 2023/01/01 〜 2024/12/31      | 105,120    | 2024/01/10 15:30      ||
|  +-------------------------------------------------------------------------------+|
|                                                                                   |
|  外部データインポート                                                             |
|  +-------------------------------------------------------------------------------+|
|  | データソース: [Yahoo Finance ▼]                                              ||
|  | 通貨ペア: USDJPY                                                              ||
|  | 時間足: [1時間足 ▼]                                                           ||
|  | 期間: [2024/01/01] 〜 [2024/12/31]                                            ||
|  |                                                                               ||
|  | [インポート実行]                                                              ||
|  +-------------------------------------------------------------------------------+|
|                                                                                   |
|  CSVファイルアップロード                                                          |
|  +-------------------------------------------------------------------------------+|
|  | 時間足: [日足 ▼]                                                              ||
|  | ファイル: [ファイルを選択]                                                    ||
|  |                                                                               ||
|  | [アップロード]                                                                ||
|  +-------------------------------------------------------------------------------+|
|                                                                                   |
+-----------------------------------------------------------------------------------+
```

#### 3.4.2 画面要素詳細

**ローカルデータ状況**
| カラム | 説明 |
|--------|------|
| 時間足 | D1, H1, M10 |
| データ期間 | データの開始日〜終了日 |
| レコード数 | 保存されているローソク足の数 |
| 最終更新 | 最後にデータが更新された日時 |

**外部データインポート**
| 要素 | タイプ | 説明 |
|------|--------|------|
| データソース | ドロップダウン | Yahoo Finance等 |
| 通貨ペア | テキスト（固定） | USDJPY |
| 時間足 | ドロップダウン | 日足, 1時間足, 10分足 |
| 期間 | 日付ピッカー×2 | 開始日〜終了日 |
| インポート実行ボタン | ボタン | 外部からデータ取得 |

**CSVファイルアップロード**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 時間足 | ドロップダウン | 日足, 1時間足, 10分足 |
| ファイル | ファイル選択 | CSVファイル |
| アップロードボタン | ボタン | CSVをインポート |

#### 3.4.3 画面アクション

| アクション | トリガー | 処理 |
|------------|----------|------|
| 外部データインポート | インポート実行ボタンクリック | POST `/api/v1/market-data/import` |
| CSVアップロード | アップロードボタンクリック | ファイルアップロード処理 |
| メイン画面に戻る | 戻るボタンクリック | SCR-001へ遷移 |

---

### 3.5 SCR-005: パフォーマンス分析画面

**実装状況**: ✓ 基本実装完了（テーブル形式）、△ グラフ表示（未実装）、✗ AI改善コメント（未実装）

**実装済みレイアウト**:
- ヘッダー: タイトルと「メイン画面に戻る」ボタン
- 主要指標カード（4つ）: 勝率、PF、最大DD、トータル損益
- リスク・リターン指標セクション: 平均利益/損失、RR比、最大利益/損失、DD継続期間（2カラムテーブル）
- 連続記録セクション: 最大連勝/連敗（2カラムテーブル）
- シミュレーション期間情報: 開始日時、終了日時、期間（3カラムテーブル）
- 資産曲線データテーブル: 最新10件（日時、残高、有効証拠金、累積損益）
- ドローダウンデータテーブル: 最新10件（日時、有効証拠金、ピーク証拠金、DD金額、DD率）

**今後の拡張**:
- グラフ表示（資産曲線、損益分布、ドローダウン）
- 期間フィルター機能
- AI改善コメント機能
- PDF/CSV出力機能

#### 3.5.1 画面レイアウト（将来の完成イメージ）

```
+-------------------------------------------------------------------------------------------+
|  FX Trade Simulator - パフォーマンス分析                              [← メイン画面に戻る]|
+-------------------------------------------------------------------------------------------+
|                                                                                           |
|  主要指標                                           期間: [全期間 ▼]  [PDF出力] [CSV出力]  |
|  +----------+ +----------+ +----------+ +----------+ +----------+ +----------+            |
|  | 勝率     | |  P/F     | | 総損益   | | R/R比    | | 最大DD   | | 連勝数   |            |
|  | 66.7%    | | 2.25     | | +¥25,000 | | 1.125    | | -1.2%    | | 5回      |            |
|  +----------+ +----------+ +----------+ +----------+ +----------+ +----------+            |
|                                                                                           |
|  資産曲線                                                                                 |
|  +-------------------------------------------------------------------------------------+ |
|  |                                                                                     | |
|  |  ¥1,025,000 ┤                                               ╱                     | |
|  |             ┤                                           ╱                         | |
|  |  ¥1,000,000 ┤───────────────╱───────╲───╱─────╱                                  | |
|  |             ┤           ╱               ╲                                         | |
|  |    ¥975,000 ┤       ╱                                                             | |
|  |             └──────────────────────────────────────────────────────────────────  | |
|  |              1/15        1/16        1/17        1/18        1/19        1/20     | |
|  +-------------------------------------------------------------------------------------+ |
|                                                                                           |
|  +------------------------------------------+ +------------------------------------------+|
|  | 損益分布                                 | | ドローダウン                             ||
|  | ¥                                        | | %                                        ||
|  | 10,000┤     ███                          | | 0.0┤─────────────╲                       ||
|  |       ┤     ███                          | |    ┤               ╲                     ||
|  |     0 ┤═════███═██═══██                  | |-1.0┤                ╲─────╱              ||
|  |       ┤     ███ ██   ██                  | |    ┤                     ╲               ||
|  |-10,000┤         ██   ██                  | |-2.0┤                      ╲──────────    ||
|  |       └──────────────────                | |    └──────────────────────────────────  ||
|  |         取引1  2  3  4  5                | |     1/15      1/17      1/19      1/20  ||
|  +------------------------------------------+ +------------------------------------------+|
|                                                                                           |
|  詳細統計                                                                                 |
|  +------------------------------------------+ +------------------------------------------+|
|  | 基本指標                                 | | リスク・リターン指標                     ||
|  | ・総トレード数: 15回                     | | ・平均利益: ¥4,500 (+29.0 pips)          ||
|  | ・勝ちトレード: 10回 (66.7%)             | | ・平均損失: ¥-4,000 (-26.7 pips)         ||
|  | ・負けトレード: 5回 (33.3%)              | | ・最大利益: ¥8,500 (55.0 pips)           ||
|  | ・総利益: ¥45,000                        | | ・最大損失: ¥-7,200 (-45.0 pips)         ||
|  | ・総損失: ¥-20,000                       | | ・リスクリワード比: 1.125                ||
|  | ・純損益: ¥25,000                        | |                                          ||
|  +------------------------------------------+ +------------------------------------------+|
|  +------------------------------------------+ +------------------------------------------+|
|  | ドローダウン指標                         | | 連続性指標                               ||
|  | ・最大ドローダウン: ¥-12,000             | | ・最大連勝: 5回                          ||
|  | ・最大ドローダウン率: -1.2%              | | ・最大連敗: 3回                          ||
|  | ・最大DD期間: 3日                        | | ・現在の連続: 2勝                        ||
|  +------------------------------------------+ +------------------------------------------+|
|                                                                                           |
|  プロからの改善コメント                                                   [更新] [コピー]|
|  +-------------------------------------------------------------------------------------+ |
|  | 💡 AI分析による改善ポイント                                                        | |
|  |                                                                                     | |
|  | 1. リスク管理の改善                                                                 | |
|  |    損切り幅が不均一です。エントリー価格の-2%を目安に統一することで、               | |
|  |    リスクをコントロールしやすくなります。                                           | |
|  |                                                                                     | |
|  | 2. トレードタイミングの最適化                                                       | |
|  |    9:00-10:00のボラティリティが高い時間帯でのエントリーが多く見られます。          | |
|  |    10:30以降の落ち着いた相場環境での取引を検討してみてください。                    | |
|  |                                                                                     | |
|  | 3. 利確戦略の見直し                                                                 | |
|  |    平均利確が+29 pipsに対し、平均損切が-27 pipsとほぼ同等です。                     | |
|  |    リスクリワード比を1.5:1以上に改善することをお勧めします。                        | |
|  |                                                                                     | |
|  | ※ このコメントはChatGPT APIによる分析結果です（最終更新: 2024/01/20 17:05）        | |
|  +-------------------------------------------------------------------------------------+ |
|                                                                                           |
+-------------------------------------------------------------------------------------------+
```

#### 3.5.2 画面要素詳細

**主要指標カード（6個）**
| カード | 指標 | 説明 |
|--------|------|------|
| 勝率 | Win Rate | 勝ちトレード数 / 総トレード数（%） |
| P/F | Profit Factor | 総利益 / 総損失 |
| 総損益 | Total P&L | 確定損益の合計 |
| R/R比 | Risk/Reward Ratio | 平均利益 / 平均損失 |
| 最大DD | Max Drawdown | 最大ドローダウン率（%） |
| 連勝数 | Consecutive Wins | 最大連勝回数 |

**資産曲線グラフ**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 資産曲線 | ラインチャート | 時系列での資産推移（Balance + Equity） |
| X軸 | 日時 | シミュレーション期間の日時 |
| Y軸 | 金額 | 資産額（円） |
| ホバー表示 | ツールチップ | 日時、残高、有効証拠金、含み損益 |

**損益分布グラフ**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 損益バー | 棒グラフ | トレードごとの確定損益 |
| X軸 | トレード番号 | 1, 2, 3... |
| Y軸 | 損益額 | 円 |
| 色分け | 緑/赤 | 利益は緑、損失は赤 |

**ドローダウングラフ**
| 要素 | タイプ | 説明 |
|------|--------|------|
| DDライン | エリアチャート | ドローダウンの推移 |
| X軸 | 日時 | シミュレーション期間の日時 |
| Y軸 | ドローダウン率 | % |
| 色分け | 赤色エリア | 下落幅を視覚化 |

**詳細統計テーブル（4セクション）**
| セクション | 表示内容 |
|-----------|---------|
| 基本指標 | 総トレード数、勝敗、総利益/損失、純損益 |
| リスク・リターン指標 | 平均利益/損失（円とpips）、最大利益/損失、R/R比 |
| ドローダウン指標 | 最大DD、最大DD率、最大DD期間 |
| 連続性指標 | 最大連勝/連敗、現在の連続 |

**プロからの改善コメント**
| 要素 | タイプ | 説明 |
|------|--------|------|
| AIコメントエリア | テキストエリア | ChatGPT APIによる改善提案を表示 |
| 更新ボタン | ボタン | AI分析を再実行 |
| コピーボタン | ボタン | コメントをクリップボードにコピー |
| タイムスタンプ | テキスト | 最終更新日時を表示 |

**AI分析の仕組み**
- トレード履歴データ（全トレードの詳細）
- 市場データ（CSV：価格、テクニカル指標）
- 上記をChatGPT APIまたはMCPサーバー経由で送信
- プロの為替トレーダー視点での改善ポイントを受信
- 3〜5個の具体的な改善提案として表示

**コントロール**
| 要素 | タイプ | 説明 |
|------|--------|------|
| 期間フィルター | ドロップダウン | 全期間/直近1週間/直近1ヶ月 |
| PDF出力ボタン | ボタン | 分析結果をPDFで出力（将来実装） |
| CSV出力ボタン | ボタン | 分析データをCSVで出力 |
| 戻るボタン | ボタン | SCR-001へ遷移 |

#### 3.5.3 画面アクション

| アクション | トリガー | 処理 |
|------------|----------|------|
| 期間変更 | 期間ドロップダウン選択 | 表示データのフィルタリング |
| CSV出力 | CSV出力ボタンクリック | GET `/api/v1/analytics/performance` → ダウンロード |
| AI分析更新 | 更新ボタンクリック | POST `/api/v1/analytics/ai-feedback` → コメント表示 |
| コメントコピー | コピーボタンクリック | クリップボードにコメントをコピー |
| メイン画面に戻る | 戻るボタンクリック | SCR-001へ遷移 |

---

## 4. レスポンシブ対応

本アプリケーションは13インチ以上のノートPC・デスクトップブラウザでの利用を前提とする。

**最小推奨解像度**: 1366×768（13インチノートPC相当）

**レイアウト調整**
| 解像度 | チャートレイアウト | 備考 |
|--------|-------------------|------|
| 1920×1080以上 | 3チャート横並び（ゆとりあり） | フルHD以上 |
| 1366×768〜1920×1080 | 3チャート横並び（コンパクト） | 13〜15インチノートPC |
| 1366×768未満 | 非対応（警告表示） | タブレット・スマホ非対応 |

**各解像度での表示仕様**
| 解像度 | チャート高さ | ポジション表示行数 |
|--------|-------------|-------------------|
| 1920×1080 | 500px | 最大10行 |
| 1600×900 | 420px | 最大6行 |
| 1366×768 | 350px | 最大4行（スクロール） |

---

## 5. カラーテーマ

| 要素 | カラーコード | 説明 |
|------|--------------|------|
| 背景色 | #1a1a2e | ダークブルー |
| カード背景 | #16213e | ネイビー |
| テキスト（通常） | #e6e6e6 | ライトグレー |
| テキスト（強調） | #ffffff | 白 |
| 買い/上昇 | #26a69a | グリーン |
| 売り/下落 | #ef5350 | レッド |
| ボタン（プライマリ） | #4fc3f7 | ライトブルー |
| ボタン（セカンダリ） | #78909c | グレー |
| ボーダー | #2d4263 | ダークブルー |

---

## 6. 使用ライブラリ（フロントエンド）

| ライブラリ | 用途 |
|------------|------|
| React | UIフレームワーク |
| TypeScript | 型安全な開発 |
| Lightweight Charts | ローソク足チャート描画 |
| Tailwind CSS | スタイリング |
| React Query | API通信・キャッシュ |
| Zustand | 状態管理 |
| date-fns | 日時処理 |
